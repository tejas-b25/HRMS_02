<div class="container department-page my-5">

  <h4 class="mb-4">Department Management</h4>

  <div *ngIf="errorSummary" class="alert alert-danger">
    {{ errorSummary }}
  </div>

  <div class="card department-card mb-4">
    <div class="card-body">

      <form [formGroup]="deptForm" (ngSubmit)="onSave()">

        <div class="mb-3">
          <label class="form-label">Department Name *</label>
          <select
            class="form-select"
            formControlName="name"
            [class.invalid]="deptForm.get('name')?.touched && deptForm.get('name')?.invalid">

            <option value="">Select department</option>

            <optgroup label="IT / Software">
              <option value="IT">IT</option>
              <option value="Software Development">Software Development</option>
              <option value="Backend Development">Backend Development</option>
              <option value="Frontend Development">Frontend Development</option>
              <option value="Full Stack Engineering">Full Stack Engineering</option>
              <option value="Quality Assurance (QA)">Quality Assurance (QA)</option>
              <option value="DevOps">DevOps</option>
              <option value="Cloud Engineering">Cloud Engineering</option>
              <option value="Cyber Security">Cyber Security</option>
              <option value="Network Administration">Network Administration</option>
              <option value="Technical Support">Technical Support</option>
            </optgroup>

            <optgroup label="Corporate">
              <option value="Human Resources">Human Resources</option>
              <option value="Finance">Finance</option>
              <option value="Administration">Administration</option>
              <option value="Procurement">Procurement</option>
              <option value="Operations">Operations</option>
              <option value="Sales">Sales</option>
              <option value="Marketing">Marketing</option>
            </optgroup>

            <optgroup label="Product & Business">
              <option value="Product Management">Product Management</option>
              <option value="Business Analysis">Business Analysis</option>
              <option value="UI/UX Design">UI/UX Design</option>
              <option value="Project Management">Project Management</option>
            </optgroup>
          </select>

          <small class="error"
            *ngIf="deptForm.get('name')?.touched && deptForm.get('name')?.invalid">
            Department name is required
          </small>
        </div>

        <div class="mb-3">
          <label class="form-label">Department Code *</label>
          <input
            type="text"
            class="form-control"
            formControlName="code"
            placeholder="e.g. IT, HR, FIN"
            [class.invalid]="deptForm.get('code')?.touched && deptForm.get('code')?.invalid">

          <small class="error"
            *ngIf="deptForm.get('code')?.touched && deptForm.get('code')?.invalid">
            Department code is required
          </small>
        </div>

        <div class="mb-3">
          <label class="form-label">Description</label>
          <textarea
            rows="2"
            class="form-control"
            formControlName="description"
            placeholder="Optional description">
          </textarea>
        </div>

        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary">
            {{ editingDept ? 'Update' : 'Add' }} Department
          </button>
          <button type="button" class="btn btn-secondary" (click)="resetForm()">
            Clear
          </button>
        </div>

      </form>

    </div>
  </div>

  <h5 class="mb-3">Department Summary</h5>

  <div class="table-responsive" *ngIf="departments.length > 0; else noDepartments">
    <table class="table table-striped table-hover">
      <thead class="table-light">
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>Code</th>
          <th>Description</th>
          <th>Status</th>
          <th class="text-center">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let d of departments; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ d.name }}</td>
          <td>{{ d.code }}</td>
          <td>{{ d.description || '-' }}</td>
          <td>
            <span class="badge"
              [class.badge-active]="d.status === 'ACTIVE'"
              [class.badge-inactive]="d.status !== 'ACTIVE'">
              {{ d.status }}
            </span>
          </td>
          <td class="text-center">
            <button class="btn btn-sm btn-outline-primary me-1" (click)="onEdit(d)">
              Edit
            </button>
            <button
              *ngIf="d.status === 'ACTIVE'"
              class="btn btn-sm btn-outline-danger"
              (click)="onDelete(d)">
              Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <ng-template #noDepartments>
    <p class="text-muted">No departments found.</p>
  </ng-template>

</div>
